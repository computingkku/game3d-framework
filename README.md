# Game3D Framework (Godot 4.4)

เอกสารฉบับนี้จัดทำขึ้นเพื่อแนะนำสถาปัตยกรรม ซอร์สโค้ด และกระบวนการใช้งานของโครงการ Game3D Framework ซึ่งพัฒนาโดยใช้ Godot Engine 4.4 โดยมีวัตถุประสงค์เพื่อเป็นกรอบงาน (framework) สำหรับการพัฒนาเกมสามมิติที่มีโครงสร้างชัดเจน รองรับการขยายผล และส่งเสริมการเรียนการสอนเชิงปฏิบัติการในรายวิชาที่เกี่ยวข้องกับการพัฒนาเกมคอมพิวเตอร์

## บทนำ
Game3D Framework มุ่งเน้นการแบ่งแยกความรับผิดชอบขององค์ประกอบในเกมอย่างชัดเจนผ่านแนวคิดเชิงวัตถุและองค์ประกอบ (Object-Oriented และ Component-based Design) โดยออกแบบคลาสแกนกลางสำหรับ “ตัวละครสามมิติ” (Actor3D) “ข้อมูลตัวละคร” (CharacterData) “แบบจำลองตัวละคร” (CharacterModel) และ “ระบบคลังไอเท็ม” (Inventory/Item system) ซึ่งเชื่อมต่อกันผ่านสัญญาณ (signals) และการอ้างอิงทรัพยากร (Resources) ทั้งนี้ โครงการมีการทำข้อมูลขับเคลื่อน (data-driven) สำหรับไอเท็มและแอนิเมชันผ่านไฟล์ JSON เพื่อให้ปรับเปลี่ยนพฤติกรรมได้โดยไม่ต้องแก้ไขซอร์สโค้ดหลัก

## คุณลักษณะโดยสรุป
- ระบบตัวละครสามมิติพื้นฐาน (เดิน วิ่ง กระโดด โจมตี ตาย) พร้อมการประมวลผลฟิสิกส์และแรงโน้มถ่วงที่กำหนดได้
- โครงแบบข้อมูลตัวละคร (ค่าสูงสุด/ปัจจุบัน, อัตราฟื้นฟู, ค่าพลังโจมตี/ป้องกัน, อัตราคริติคอล ฯลฯ) และกลไกคำนวณค่าสถานะหลังสวมใส่อุปกรณ์
- ระบบแบบจำลองตัวละครและแผนที่แอนิเมชันผ่าน JSON (รองรับ idle/walk/run/jump/attack/death และชุดเฉพาะเมื่อถืออาวุธ)
- ระบบไอเท็ม/คลังไอเท็มแบบขับเคลื่อนด้วยข้อมูล (JSON → ItemData → Inventory) ครอบคลุมไอเท็มบริโภค, อาวุธ, โล่ และอุปกรณ์สวมใส่
- ส่วนติดต่อผู้ใช้สำหรับคลังไอเท็มและสถานะตัวละคร พร้อมการสื่อสารกับระบบหลักผ่านสัญญาณ
- โครงสร้างโค้ดชัดเจน แยกเป็นสคริปต์หลัก ฉาก (scenes) และทรัพยากร (resources)

## สถาปัตยกรรมเชิงระบบ
- Actor3D (`scripts/actors/Actor3D.gd`): คลาสฐานของตัวละครแบบ `CharacterBody3D` จัดการวงจรอัปเดต การเล่นแอนิเมชัน การรับ/คำนวณแรงโน้มถ่วง สถานะมีชีวิต/เสียชีวิต และสัญญาณเหตุการณ์พื้นฐาน (เช่น โดนโจมตี ตาย ฟื้น)
- Player3D (`characters/players/Player3D.gd`): สืบทอดจาก Actor3D เพิ่มตรรกะควบคุมอินพุตกล้อง/การเคลื่อนที่แบบลื่นไหล (ground/air acceleration, friction, air control, coyote time, jump buffer) และเชื่อมต่อกับ `InventoryData`
- CharacterData (`scripts/actors/CharacterData.gd`): ทรัพยากรเก็บค่าสถานะตัวละคร (hp/mp/stamina, max, attack/defense, regen ฯลฯ) พร้อม setters ที่กระตุ้นการคำนวณสถานะรวมและส่งสัญญาณเปลี่ยนแปลงค่า
- CharacterModel (`scripts/actors/CharacterModel.gd`): โหนดสำหรับจัดการชุดอุปกรณ์ที่ติดบนโมเดล 3D และแผนที่ชื่อแอนิเมชันตาม “การกระทำ”/สภาพการถืออาวุธ โหลดข้อมูลแอนิเมชัน/ไอเท็มจากไฟล์ JSON และควบคุมช่วง “โจมตีโดน” ผ่านตัวจับเวลา
- Inventory/Item System:
  - ItemData (`scripts/inventory/ItemData.gd`): ทรัพยากรนิยามไอเท็ม (id, ชื่อ, คำอธิบาย, ชนิด, ไอคอน, ทางโหนด, ความจุซ้อน, น้ำหนัก, เอฟเฟกต์, เมทาดาทา)
  - ItemEffect (`scripts/inventory/ItemEffect.gd`): อธิบายผลของไอเท็มต่อค่าสถานะ (เพิ่ม/คูณ) พร้อมตรรกะ clamp ตามค่าสูงสุดที่เกี่ยวข้อง
  - ItemHelper (`scripts/inventory/ItemHelper.gd`): ยูทิลิตีสำหรับอ่าน JSON เป็น ItemData, แปลงชนิดไอเท็ม, ค้นหา/กรองรายการ, โหลดไอคอน ฯลฯ
  - InventoryData (`scripts/inventory/InventoryData.gd`): จัดการคลัง (เพิ่ม/ลด/ใช้ไอเท็ม) และส่งสัญญาณเมื่อมีการเปลี่ยนแปลง
- ระบบออโต้โหลด (Autoload):
  - GameManager (`scripts/autoloads/GameManager.gd`): เก็บอ้างอิงผู้เล่น ปักธงการมองเห็น UI จัดการการแจ้งเตือน และสื่อสารสถานะส่วนกลางของเกม
  - Types (`scripts/autoloads/Types.gd`): เก็บนิยามชนิดไอเท็มและคีย์สถานะมาตรฐาน
- ส่วนติดต่อผู้ใช้: UI Inventory (`scenes/ui/ui_inventory.gd`) สร้างปุ่มไอเท็มแบบไดนามิกตามคลังของผู้เล่น รองรับกดเพื่อสวมใส่/บริโภค

## โครงสร้างไดเรกทอรี (สรุป)
```
assets/            ทรัพยากรสื่อ (โมเดล ไอคอน เสียง)
characters/        สคริปต์และฉากของตัวละคร (เช่น Player3D)
objects/           วัตถุเกมทั่วไป (เช่น ไอเท็มตกพื้น)
resources/         ข้อมูล JSON (เช่น ไอเท็ม/แอนิเมชัน), ธีม ฯลฯ
scenes/            ฉากหลัก/ย่อย และ UI
scripts/           สคริปต์แกนกลาง (actors, inventory, autoloads, shaders)
docs/              ชุดสร้างเผยแพร่ Web (WASM) สำหรับสาธิต
project.godot      การตั้งค่าโปรเจกต์ Godot 4.4
```

## ข้อมูลขับเคลื่อน (Data-Driven)
- แผนที่แอนิเมชัน: ตัวอย่างที่ `resources/knight_animations.json` และ `resources/skeleton_warrior_animations.json` กำหนดรายการชื่อแอนิเมชันสำหรับแต่ละ “การกระทำ” (เช่น `idle`, `walk`, `attack`, `death`) และชุดเฉพาะเมื่อถืออาวุธ (`*_weapon`). `CharacterModel` จะสุ่มเลือกหนึ่งรายการจากชุดตามบริบท
- ไอเท็มและอุปกรณ์: ไฟล์เช่น `resources/knight_items.json`, `resources/skeleton_warrior_items.json`, และ `resources/items.json` นิยามคุณลักษณะไอเท็ม ชนิด (CONSUMABLE/WEAPON/SHIELD/EQUIPMENT) ตำแหน่งโหนดติดตั้งบนโมเดล (กรณีอุปกรณ์) และผลกระทบต่อค่าสถานะ (ผ่าน `states_add`/`states_mul`)

ตัวอย่างนิยามไอเท็ม (ย่อ):
```json
{
  "id": "knight_sword1",
  "name": "ดาบสั้น",
  "node": "Rig/Skeleton3D/1H_Sword/1H_Sword",
  "icon": "res://assets/icons/sword1.png",
  "item_type": "WEAPON",
  "effect": { "states_add": { "attack": 5 } },
  "meta": { "price": 25, "rarity": "common" }
}
```

## การติดตั้งและการใช้งาน
ข้อกำหนดเบื้องต้น: Godot Engine 4.4

ขั้นตอน:
1) เปิดโครงการด้วย Godot 4.4 (ไฟล์ `project.godot`)
2) รันฉากหลักผ่านปุ่ม F5 (ค่าเริ่มต้นในโปรเจกต์กำหนดฉากหลักไว้แล้ว)
3) ควบคุมพื้นฐานในเกม:
   - เดิน/วิ่ง: W/A/S/D (กด Shift เพื่อเร่งความเร็ว)
   - กระโดด: Space
   - โจมตี: X หรือคลิกเมาส์ซ้าย
   - เปิด/ปิดคลังไอเท็ม: I
   - โหมดเมาส์: Esc เพื่อแสดง/ซ่อนเคอร์เซอร์

หมายเหตุ: โปรเจกต์มีชุดสาธิตสำหรับเว็บที่ `docs/` (WASM/HTML) ซึ่งสามารถใช้สำหรับการเผยแพร่ทดสอบได้

## แนวทางการขยายผล
- เพิ่มตัวละครหรือศัตรูใหม่โดยสืบทอดจาก `Actor3D` และกำหนด `CharacterData`/`CharacterModel` ให้สอดคล้อง
- เพิ่มไอเท็ม/อุปกรณ์/แอนิเมชันใหม่ผ่านไฟล์ JSON โดยไม่ต้องแก้ไขตรรกะแกนกลาง
- ปรับแต่ง UI Inventory โดยแก้ไขโหนดและสคริปต์ใน `scenes/ui/`
- เติมระบบสถานะ (buff/debuff) ผ่าน `ItemEffect` และกลไกคำนวณใน `CharacterData`

## คุณภาพซอฟต์แวร์และสัญญาณ (Signals)
ระบบใช้สัญญาณอย่างกว้างขวางเพื่อแยกส่วนประกอบและทำให้เกิดการสื่อสารแบบหลวม (loose coupling) เช่น การเปลี่ยนค่า hp/mp/stamina, การตาย/ฟื้น, การเปลี่ยนสถานะสวมใส่, การเปลี่ยนคลังไอเท็ม และการแจ้งเตือนส่วนกลางผ่าน `GameManager` ช่วยให้การทดสอบและการเปลี่ยนองค์ประกอบทำได้สะดวก

## ลิขสิทธิ์และสัญญาอนุญาต
โครงการเผยแพร่ภายใต้สัญญาอนุญาตแบบ MIT (ดูไฟล์ `LICENSE`). ผู้ใช้สามารถนำไปใช้ ดัดแปลง และเผยแพร่ต่อได้โดยต้องคงไว้ซึ่งประกาศลิขสิทธิ์และสัญญาอนุญาตดังกล่าว

## ผู้พัฒนา
วชิราวุธ ธรรมวิเศษ และผู้มีส่วนร่วมอื่น ๆ ตามที่ระบุในประวัติซอร์สโค้ด
